<!DOCTYPE html>
<html lang="en">
<head>
    <title>Ice Cream Parlour Billing</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/angular-ui/bower-ui-grid/ui-grid.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/angular-ui/bower-ui-grid/ui-grid.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.5/css/bootstrap-select.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.5/js/bootstrap-select.min.js"></script>

    <style>
    </style>
    <!--<script src="~/Scripts/angular-ui/ui-bootstrap-tpls.min.js"></script>-->
    <!--<script src="~/Scripts/app/controllers/IceCreamController.js"></script>-->

    <script>
        var app = angular.module('IceCreamApp', []);


        app.controller('IceCreamController', function ($scope, $http) {

            var url = "http://localhost:60291";

            $scope.arrlist = [{
                "id": 1,
                "name": "1"
            }, {
                "id": 2,
                "name": "2"
            }, {
                "id": 3,
                "name": "3"
            }];
            $scope.checkselection = function () {
                if ($scope.userSelect != "" && $scope.userSelect != undefined)
                    $scope.msg = 'Selected Value: ' + $scope.userSelect;
                else
                    $scope.msg = 'Please Select Dropdown Value';
            }

            $scope.FlavoursList = null;
            $scope.ToppingsList = null;
            $scope.BillList = null;





            //Declaring the function to load data from database
            $scope.fillFlavoursList = function () {
                $http({
                    method: 'GET',
                    url: url + '/api/Flavours',
                    data: {}
                }).success(function (result) {
                    $scope.FlavoursList = result;
                });
            };
            //Calling the function to load the data on pageload
            $scope.fillFlavoursList();
            $scope.fillToppingsList = function () {
                $http({
                    method: 'GET',
                    url: url + '/api/Toppings',
                    data: {}
                }).success(function (result) {
                    $scope.ToppingsList = result;
                });
            };
            //Calling the function to load the data on pageload
            $scope.fillToppingsList();


            $scope.GenerateBill = function () {

                var postdataArray = [];
                angular.forEach($scope.iceCreamArray, function (value) {
                    var icecream = {};
                    icecream.FlavourId = value.FlavourId;
                    icecream.ToppingsId = value.ToppingsId;
                    icecream.Scoop = value.Scoop;
                    postdataArray.push(icecream);
                });
                $scope.BillList = [];

                $http({
                    method: 'POST',
                    url: url + '/api/GenerateBill',
                    contentType: "application/json",
                    data: JSON.stringify(postdataArray)
                }).success(function (result) {

                    handleResult(result);


                });
            };


            function handleResult(result) {

                var price = 0;
                console.log(price);
                angular.forEach(result,
                    function (value) {
                        console.log(value.Price);
                        price = price + value.Price;
                    });
                console.log(price);
                $scope.totalprice = price;
                console.log(result);
                $scope.BillList = result;
            };

            $scope.iceCreamArray = [

            ];


            // GET VALUES FROM INPUT BOXES AND ADD A NEW ROW TO THE TABLE.
            $scope.addRow = function () {
                if ($scope.Flavours.FlId != undefined && $scope.userSelect != undefined) {
                    var icecream = [];
                    icecream.FlavourId = $scope.Flavours.FlId;
                    icecream.ToppingsId = $scope.Toppings.Id;
                    icecream.Scoop = $scope.userSelect;
                    icecream.flavour = $scope.Flavours.FlName;
                    icecream.topping = $scope.Toppings.Name;

                    $scope.iceCreamArray.push(icecream);
                }
            };

            // REMOVE SELECTED ROW(s) FROM TABLE.
            $scope.removeRow = function (rowId) {
                $scope.iceCreamArray.splice(rowId, 1);
            };
            $scope.Clear = function () {
                $scope.iceCreamArray = [];
                $scope.BillList = [];
            };


        });


    </script>
    <style>
        table, td, th {
            margin: 10px 0;
            padding: 2px 10px;
        }

        td, th {
            border: solid 1px #CCC;
        }

        button {
            font: 13px Verdana;
            padding: 3px 5px;
        }

        thead {
            background: #343a40 !important;
            color: white;
        }

        .action {
            text-align: center;
        }
    </style>
</head>
<body ng-app="IceCreamApp" class="container" style="background-color:beige; margin-bottom: 2px; font-family: 'dax-regular'">
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <a class="navbar-brand" href="#">Home</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavbar" align="right">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="#">Flavours</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Toppings</a>
                </li>

            </ul>
        </div>
    </nav>
    <div class="jumbotron text-center" style="margin-bottom: 0; background-image: url(Content/images/strawberry-ice-cream.jpg);
         background-repeat: no-repeat, repeat; background-size: 100% 100%;  background-color: #cccccc; width: 100%;height: 250px;">


        <h1>Von's Icecream Billling System</h1>
        <p>Welcome to Von's IceCream Billing System</p>
    </div>



    <div class="container" style="margin-top: 30px;" ng-controller="IceCreamController">
        <div class="row">

            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12pull-left">
                <section>
                    <div class="row">
                        <div class="form-group">
                            <label>Select Flavour:</label>
                            <label></label>


                            <select ng-model="Flavours" class="form-control" ng-options="Flavour.FlName for Flavour in FlavoursList"></select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group">

                            <label>Select Toppings:</label>


                            <select ng-model="Toppings" class="form-control" ng-options="Toppings.Name for Toppings in ToppingsList">
                                <option value="" label="--None--"></option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group">

                            <label>Select Scoops:</label>


                            <select name="users" class="form-control" ng-model="userSelect">

                                <option value="">--Select Scoops--</option>

                                <option ng-repeat="option in arrlist" value="{{option.id}}">{{option.name}}</option>

                            </select>
                        </div>
                    </div>
                    <div class="row">

                        <input type="submit" class="btn btn-info" value="Add to Bill" ng-click="addRow()">&nbsp;
                        <button ng-click="Clear()" class="btn btn-info">Clear</button>

                    </div>

                    <div class="row table-responsive" ng-show="iceCreamArray.length!= 0">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Sl No</th>
                                    <th>Flavour</th>
                                    <th>Toppimg</th>
                                    <th>No Of Scoop</th>
                                    <th class="action">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="icecream in iceCreamArray">
                                    <td><label>{{$index + 1}}</label></td>
                                    <td><label>{{icecream.flavour}}</label></td>
                                    <td><label>{{icecream.topping}}</label></td>
                                    <td><label>{{icecream.Scoop}}</label></td>
                                    <td class="action"><a ng-click="removeRow($index)" class="glyphicon glyphicon-trash text-danger"></a></td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="">
                            <button ng-click="GenerateBill()" class="btn btn-info">Generate Bill</button>

                        </div>
                    </div>
                </section>
            </div>
        </div>



        <div class="row table-responsive" ng-show="BillList!= undefined && BillList.length!= 0 ">

            <table class="table">
                <thead>
                    <tr>
                        <th>Sl No</th>
                        <th>Flavour</th>
                        <th>Topping</th>
                        <th>Price</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="icecream in BillList">
                        <td><label>{{$index + 1}}</label></td>
                        <td><label>{{icecream.Flavour}}</label></td>
                        <td><label>{{icecream.Topping}}</label></td>
                        <td><label>&#x20b9;{{icecream.Price}}</label></td>
                    </tr>
                    <tr>

                        <td><label>Total Price</label></td>
                        <td><label>&#x20b9;{{totalprice}}</label></td>

                    </tr>
                </tbody>
            </table>

        </div>

    </div>

</body>
</html>
